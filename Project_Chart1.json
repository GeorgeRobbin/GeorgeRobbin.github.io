{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  
    "width": 500,
    "height": 300,
    "view": {"stroke": "transparent"},
  
    "title": {
        "text": "Housing price in USA",
        "fontSize": 12,
        "subtitle":["Offences per 100k population. Source FBI, 2019", ""],
        "subtitleFontStyle":"italic",
        "subtitleFontSize":10, "anchor": "middle"},
    
    "data": {
      "url": "https://raw.githubusercontent.com/RDeconomist/RDeconomist.github.io/main/charts/maps/geoUSStates.json",
      "format": {"property": "features"}
    },
  
    "projection": {"type": "albersUsa"},
    "mark": "geoshape", 
  
    "params": [
      {"name": "Select",
        "value": "HPI Index",
        "bind": {
          "input": "select",
          "options": [
            "HPI Index",
            "Annual Change (%)"]}},


      {"name": "yearSelector", 
       "value":"1975",
       "bind":{
         "input": "range",
         "min": "1975",
         "max": "2021",
         "step":"1",
         "name": "Year:"}}],

  
    "transform": [
              
        {"lookup": "HPI Index",
            "from": {
                "data": {"url": "https://raw.githubusercontent.com/GeorgeRobbin/GeorgeRobbin.github.io/main/US_House_Price_wide.csv"},
                "key": "State",
                "fields": [       
                    "HPI Index",
                    "Annual Change (%)"
                    ]}},

          {"calculate": "datum[Select]","as": "value"},
          {"calculate": "toNumber(yearSelector)", "as": "Year"},
            {"filter":"datum.Year == datum.Year"}],
 
    "encoding":{
      
        "color":{
            "field":"HPI Index",
            "legend":{
                "title":null,
                "orient": "right",
                "direction": "vertical"},
            "type": "quantitative",
            "scale":{"scheme":"lightgreyred"}},
      
        "tooltip":[
            {"field":"properties.NAME", "title": "State"},
            {"field":"value", "title": "Offending rate", "format": ",d"}]
    }
  }
